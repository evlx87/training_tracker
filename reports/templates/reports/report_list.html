{% extends 'base.html' %}
{% load report_filters %}
{% block title %}
–û—Ç—á–µ—Ç—ã –ø–æ –æ–±—É—á–µ–Ω–∏—é
{% endblock %}
{% block content %}
<h1>–û—Ç—á–µ—Ç—ã –ø–æ –æ–±—É—á–µ–Ω–∏—é</h1>

<div class="filters-container">
    <form class="filter-form" method="get">
        <div class="form-group">
            <label for="employees"><span class="icon">üë§</span> –°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏:</label>
            <select name="employees" id="employees" multiple class="form-input">
                <option value="" {% if not selected_employees %}selected{% endif %}>–í—Å–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏</option>
                {% for employee in employees %}
                <option value="{{ employee.pk }}" {% if employee.pk|stringformat:"s" in selected_employees %}selected{% endif %}>
                    {{ employee.last_name }} {{ employee.first_name }} {{ employee.middle_name|default_if_none:"" }}
                </option>
                {% endfor %}
            </select>
        </div>

        <div class="form-group">
            <label for="program"><span class="icon">üìö</span> –ü—Ä–æ–≥—Ä–∞–º–º–∞ –æ–±—É—á–µ–Ω–∏—è:</label>
            <select name="program" id="program" class="form-input">
                <option value="" {% if not selected_program %}selected{% endif %}>–í—Å–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã</option>
                {% for program in training_programs %}
                <option value="{{ program.id }}" {% if selected_program == program.id|stringformat:"s" %}selected{% endif %}>
                    {{ program.name }}
                </option>
                {% endfor %}
            </select>
        </div>

        <div class="form-group form-checkbox">
            <input type="checkbox" name="exclude_not_completed" id="exclude_not_completed" {% if exclude_not_completed %}checked{% endif %}>
            <label for="exclude_not_completed"><span class="icon">‚úñ</span> –ò—Å–∫–ª—é—á–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –±–µ–∑ –æ–±—É—á–µ–Ω–∏—è</label>
        </div>

        <div class="buttons-group">
            <button type="submit" class="button button--primary"><span class="icon">üîç</span> –ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
            <a href="{% url 'reports:report_list' %}" class="button button--danger"><span class="icon">‚úñ</span> –°–±—Ä–æ—Å–∏—Ç—å</a>
            <a href="{% url 'reports:export_report' %}" class="button button--success"><span class="icon">üì•</span> –≠–∫—Å–ø–æ—Ä—Ç –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö</a>
            {% if selected_employees or selected_program or exclude_not_completed %}
            <a href="{% url 'reports:export_report' %}?{% if selected_employees %}employees={{ selected_employees|join:'&employees=' }}&{% endif %}{% if selected_program %}program={{ selected_program }}&{% endif %}{% if exclude_not_completed %}exclude_not_completed=on{% endif %}" class="button button--info"><span class="icon">üìà</span> –≠–∫—Å–ø–æ—Ä—Ç —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏</a>
            {% endif %}
        </div>
    </form>
</div>

<div class="legend">
    <span class="legend-item not-completed">–ù–µ –ø—Ä–æ–π–¥–µ–Ω–æ</span>
    <span class="legend-item overdue">–ü—Ä–æ—Å—Ä–æ—á–µ–Ω–æ</span>
    <span class="legend-item warning">–°–∫–æ—Ä–æ –∏—Å—Ç–µ–∫–∞–µ—Ç</span>
    <span class="legend-item completed">–ü—Ä–æ–π–¥–µ–Ω–æ</span>
</div>

{% if selected_employees or selected_program %}
<div class="table-container">
    <table class="report-table">
        <thead>
            <tr>
                <th class="sortable">
                    <a href="?{% query_string 'sort_by=last_name' 'sort_order' %}"
                       class="sort-icon {% if sort_by == 'last_name' %}{{ sort_order }}{% endif %}">
                        –°–æ—Ç—Ä—É–¥–Ω–∏–∫
                    </a>
                </th>
                <th>–î–æ–ª–∂–Ω–æ—Å—Ç—å</th>
                <th>–ü–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ</th>
                {% if selected_program %}
                <th class="sortable">
                    <a href="?{% query_string 'sort_by='|add:selected_program 'sort_order' %}"
                       class="sort-icon {% if sort_by == selected_program %}{{ sort_order }}{% endif %}">
                        {{ selected_program_name }}
                    </a>
                </th>
                {% else %}
                {% for program in training_programs %}
                <th class="sortable">
                    <a href="?{% query_string 'sort_by='|add:program.id 'sort_order' %}"
                       class="sort-icon {% if sort_by == program.id|stringformat:'s' %}{{ sort_order }}{% endif %}">
                        {{ program.name }}
                    </a>
                </th>
                {% endfor %}
                {% endif %}
            </tr>
        </thead>
        <tbody>
            {% for data in report_data %}
            <tr>
                <td>
                    {{ data.employee.last_name }} {{ data.employee.first_name.0 }}. {% if data.employee.middle_name %}{{ data.employee.middle_name.0 }}.{% endif %}
                    {% if data.employee.position %}
                        {% if data.employee.position.is_manager %}
                            <span class="manager-icon" title="–†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å">üëë</span>
                        {% endif %}
                        {% if data.employee.position.is_teacher %}
                            <span class="teacher-icon" title="–ü–µ–¥–∞–≥–æ–≥–∏—á–µ—Å–∫–∏–π —Ä–∞–±–æ—Ç–Ω–∏–∫">üìö</span>
                        {% endif %}
                    {% endif %}
                </td>
                <td>{{ data.employee.position|default:"‚Äî" }}</td>
                <td>{{ data.employee.department|default:"‚Äî" }}</td>
                {% if selected_program %}
                {% with training_status=data.trainings|int_key:selected_program %}
                <td class="{{ training_status.class }}">
                    {% if training_status and training_status.date != "–û–±—É—á–µ–Ω–∏–µ –Ω–µ –ø—Ä–æ–π–¥–µ–Ω–æ" %}
                    {{ training_status.date|date:"d.m.y" }}
                    {% if training_status.is_verified %}
                        <span class="verified-icon" title="–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ">‚úÖ</span>
                    {% else %}
                        <span class="not-verified-icon" title="–ù–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ">‚ùå</span>
                    {% endif %}
                    {% else %}
                    ‚úñ
                    {% endif %}
                </td>
                {% endwith %}
                {% else %}
                {% for program in training_programs %}
                {% with training_status=data.trainings|int_key:program.id %}
                <td class="{{ training_status.class }}">
                    {% if training_status and training_status.date != "–û–±—É—á–µ–Ω–∏–µ –Ω–µ –ø—Ä–æ–π–¥–µ–Ω–æ" %}
                    {{ training_status.date|date:"d.m.y" }}
                    {% if training_status.is_verified %}
                        <span class="verified-icon" title="–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ">‚úÖ</span>
                    {% else %}
                        <span class="not-verified-icon" title="–ù–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ">‚ùå</span>
                    {% endif %}
                    {% else %}
                    ‚úñ
                    {% endif %}
                </td>
                {% endwith %}
                {% endfor %}
                {% endif %}
            </tr>
            {% empty %}
            <tr>
                <td colspan="{% if selected_program %}4{% else %}{{ training_programs|length|add:3 }}{% endif %}">–î–∞–Ω–Ω—ã–µ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% else %}
<div class="instructions">
    <h2><span class="icon">üìã</span> –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —Ä–∞–±–æ—Ç–µ —Å –æ—Ç—á–µ—Ç–æ–º</h2>
    <p>–ù–∞ —ç—Ç–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ –≤—ã –º–æ–∂–µ—Ç–µ —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –æ—Ç—á–µ—Ç –ø–æ –æ–±—É—á–µ–Ω–∏—é —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤. –î–ª—è —ç—Ç–æ–≥–æ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:</p>
    <ol>
        <li>–í —Ä–∞–∑–¥–µ–ª–µ <b>–°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏</b> –≤—ã–±–µ—Ä–∏—Ç–µ –æ–¥–Ω–æ–≥–æ –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤, –∫–æ—Ç–æ—Ä—ã—Ö —Ö–æ—Ç–∏—Ç–µ –≤–∫–ª—é—á–∏—Ç—å –≤ –æ—Ç—á–µ—Ç. –î–ª—è –≤—ã–±–æ—Ä–∞ –≤—Å–µ—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –æ—Å—Ç–∞–≤—å—Ç–µ –ø–æ–ª–µ –ø—É—Å—Ç—ã–º.</li>
        <li>–í —Ä–∞–∑–¥–µ–ª–µ <b>–ü—Ä–æ–≥—Ä–∞–º–º–∞ –æ–±—É—á–µ–Ω–∏—è</b> –≤—ã–±–µ—Ä–∏—Ç–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –ø—Ä–æ–≥—Ä–∞–º–º—É, —á—Ç–æ–±—ã –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ —Ç–æ–ª—å–∫–æ –ø–æ –Ω–µ–π. –ï—Å–ª–∏ –≤—ã–±—Ä–∞—Ç—å <b>–í—Å–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã</b>, –æ—Ç—á–µ—Ç –±—É–¥–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –æ–±—â—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é.</li>
        <li>–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Ñ–ª–∞–∂–æ–∫ <b>–ò—Å–∫–ª—é—á–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –±–µ–∑ –æ–±—É—á–µ–Ω–∏—è</b>, —á—Ç–æ–±—ã –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å —Ç–æ–ª—å–∫–æ —Ç–µ—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–æ—à–ª–∏ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ –æ–±—É—á–µ–Ω–∏–µ (–∏–ª–∏ –≤—ã–±—Ä–∞–Ω–Ω—É—é –ø—Ä–æ–≥—Ä–∞–º–º—É).</li>
        <li>–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É <b>–ü—Ä–∏–º–µ–Ω–∏—Ç—å</b>, —á—Ç–æ–±—ã —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É —Å –¥–∞–Ω–Ω—ã–º–∏.</li>
        <li>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫—É <b>–≠–∫—Å–ø–æ—Ä—Ç –≤ Excel</b> –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –æ—Ç—á–µ—Ç–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ Excel.</li>
        <li>–õ–µ–≥–µ–Ω–¥–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç—É—Å—ã –æ–±—É—á–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤ —Ç–∞–±–ª–∏—Ü–µ:</li>
    </ol>

    <h2><span class="icon">üìã</span> –û–ø–∏—Å–∞–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤</h2>
    <ul>
        <li><b>–ü—Ä–æ–π–¥–µ–Ω–æ</b> (–∑–µ–ª–µ–Ω—ã–π —Ñ–æ–Ω): –û–±—É—á–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω–æ –≤ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Å—Ä–æ–∫–∏.</li>
        <li><b>–ù–µ –ø—Ä–æ–π–¥–µ–Ω–æ</b> (—Å–≤–µ—Ç–ª–æ-–∫—Ä–∞—Å–Ω—ã–π —Ñ–æ–Ω): –û–±—É—á–µ–Ω–∏–µ –Ω–µ –±—ã–ª–æ –Ω–∞—á–∞—Ç–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–º.</li>
        <li><b>–ü—Ä–æ—Å—Ä–æ—á–µ–Ω–æ</b> (–∫—Ä–∞—Å–Ω—ã–π —Ñ–æ–Ω): –°—Ä–æ–∫ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è –æ–±—É—á–µ–Ω–∏—è –∏—Å—Ç–µ–∫, –∏ –æ–Ω–æ –Ω–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ.</li>
        <li><b>–°–∫–æ—Ä–æ –∏—Å—Ç–µ–∫–∞–µ—Ç</b> (–∂–µ–ª—Ç—ã–π —Ñ–æ–Ω): –û–±—É—á–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ, –Ω–æ –¥–æ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è –æ—Å—Ç–∞–ª–æ—Å—å –º–µ–Ω–µ–µ 1 –º–µ—Å—è—Ü–∞.</li>
    </ul>
</div>
{% endif %}

{% endblock %}