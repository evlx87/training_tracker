{% extends 'base.html' %}
{% load i18n report_filters %}
{% block title %}
–û—Ç—á–µ—Ç—ã –ø–æ –æ–±—É—á–µ–Ω–∏—é
{% endblock %}
{% block content %}
<h1>–û—Ç—á–µ—Ç—ã –ø–æ –æ–±—É—á–µ–Ω–∏—é</h1>
<div class="filters-container">
    <form method="get" class="filter-form">
        <div class="form-group">
            <label for="employees"><span class="icon">üë§</span> –°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏:</label>
            <select id="employees" name="employees" multiple class="form-input" size="5">
                <option value="" {% if not selected_employees %}selected{% endif %}>–í—Å–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏</option>
                {% for employee in employees %}
                <option value="{{ employee.pk }}"
                        {% if employee.pk|stringformat:"s" in selected_employees %}selected{% endif %}>
                {{ employee.last_name }} {{ employee.first_name }} {{ employee.middle_name|default_if_none:"" }}
                </option>
                {% endfor %}
            </select>
        </div>
        <div class="form-group">
            <label for="program"><span class="icon">üìö</span> –ü—Ä–æ–≥—Ä–∞–º–º–∞ –æ–±—É—á–µ–Ω–∏—è:</label>
            <select id="program" name="program" class="form-input">
                <option value="" {% if not selected_program %}selected{% endif %}>–í—Å–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã</option>
                {% for program in training_programs %}
                <option value="{{ program.id }}" {% if selected_program|add:"0" == program.id|add:"0" %}selected{% endif %}>
                {{ program.name }}
                </option>
                {% endfor %}
            </select>
        </div>
        <div class="form-group form-checkbox">
            <label for="exclude_not_completed"><span class="icon">‚úñ</span> –ò—Å–∫–ª—é—á–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –±–µ–∑ –æ–±—É—á–µ–Ω–∏—è:</label>
            <input type="checkbox" id="exclude_not_completed" name="exclude_not_completed" {% if request.GET.exclude_not_completed %}checked{% endif %}>
        </div>
        <div class="buttons-group">
            <button type="submit" class="button button--primary"><span class="icon">üîç</span> –ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
            {% if report_data %}
            <a href="{% url 'reports:export_report' %}?employees={{ request.GET.employees|urlencode }}&program={{ request.GET.program|urlencode }}&exclude_not_completed={{ request.GET.exclude_not_completed|urlencode }}"
               class="button button--success"><span class="icon">üì•</span> –≠–∫—Å–ø–æ—Ä—Ç –≤ Excel</a>
            {% endif %}
        </div>
    </form>
</div>
<div class="legend">
    <div class="legend-item not-completed">
        <span class="icon">‚úñ</span> –ù–µ –ø—Ä–æ–π–¥–µ–Ω–æ
    </div>
    <div class="legend-item overdue">
        <span class="icon">‚è∞</span> –ü—Ä–æ—Å—Ä–æ—á–µ–Ω–æ
    </div>
    <div class="legend-item warning">
        <span class="icon">‚ö†</span> –°–∫–æ—Ä–æ –∏—Å—Ç–µ–∫–∞–µ—Ç
    </div>
    <div class="legend-item completed">
        <span class="icon">‚úî</span> –ü—Ä–æ–π–¥–µ–Ω–æ
    </div>
</div>
{% if selected_employees or selected_program %}
<div class="table-container">
    <table class="report-table">
        <thead>
        <tr>
            <th>–°–æ—Ç—Ä—É–¥–Ω–∏–∫</th>
            <th>–î–æ–ª–∂–Ω–æ—Å—Ç—å</th>
            <th>–†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å</th>
            <th>–ü–µ–¥–∞–≥–æ–≥–∏—á–µ—Å–∫–∏–π —Ä–∞–±–æ—Ç–Ω–∏–∫</th>
            <th>–ß–ª–µ–Ω –∫–æ–º–∏—Å—Å–∏–∏</th>
            <th>–ü–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ</th>
            {% if selected_program %}
            <th>{{ selected_program_name }}</th>
            {% endif %}
        </tr>
        </thead>
        <tbody>
        {% for data in report_data %}
        <tr class="employee-row">
            <td>{{ data.employee.last_name }} {{ data.employee.first_name.0 }}. {% if data.employee.middle_name %}{{ data.employee.middle_name.0 }}.{% endif %}</td>
            <td>{{ data.employee.position|default:"‚Äî" }}</td>
            <td>{{ data.employee.position.is_manager|yesno:"–î–∞,–ù–µ—Ç" }}</td>
            <td>{{ data.employee.position.is_teacher|yesno:"–î–∞,–ù–µ—Ç" }}</td>
            <td>{{ data.employee.is_safety_commission_member|yesno:"–î–∞,–ù–µ—Ç" }}</td>
            <td>{{ data.employee.department|default:"‚Äî" }}</td>
            {% if selected_program %}
            {% with training_status=data.trainings|int_key:selected_program %}
            <td class="{{ training_status|dict_get:'class'|default:'not-completed' }}"
                title="{{ training_status|dict_get:'details'|default:'' }}">
                {% if training_status and training_status.date != "–û–±—É—á–µ–Ω–∏–µ –Ω–µ –ø—Ä–æ–π–¥–µ–Ω–æ" %}
                {{ training_status.date|date:"d.m.y" }}
                <span class="icon">{{ training_status.class|get_status_icon }}</span>
                {% else %}
                <span class="icon">‚úñ</span>
                {% endif %}
            </td>
            {% endwith %}
            {% endif %}
        </tr>
        {% empty %}
        <tr>
            <td colspan="7">–î–∞–Ω–Ω—ã–µ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã.</td>
        </tr>
        {% endfor %}
        </tbody>
    </table>
</div>
{% else %}
<div class="instructions">
    <h2><span class="icon">üìã</span> –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —Ä–∞–±–æ—Ç–µ —Å –æ—Ç—á–µ—Ç–æ–º</h2>
    <p>–ù–∞ —ç—Ç–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ –≤—ã –º–æ–∂–µ—Ç–µ —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –æ—Ç—á–µ—Ç –ø–æ –æ–±—É—á–µ–Ω–∏—é —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤. –î–ª—è —ç—Ç–æ–≥–æ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:</p>
    <ol>
        <li>–í —Ä–∞–∑–¥–µ–ª–µ <strong>–°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏</strong> –≤—ã–±–µ—Ä–∏—Ç–µ –æ–¥–Ω–æ–≥–æ –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤, –∫–æ—Ç–æ—Ä—ã—Ö —Ö–æ—Ç–∏—Ç–µ –≤–∫–ª—é—á–∏—Ç—å –≤ –æ—Ç—á–µ—Ç. –î–ª—è –≤—ã–±–æ—Ä–∞ –≤—Å–µ—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –æ—Å—Ç–∞–≤—å—Ç–µ –ø–æ–ª–µ –ø—É—Å—Ç—ã–º.</li>
        <li>–í —Ä–∞–∑–¥–µ–ª–µ <strong>–ü—Ä–æ–≥—Ä–∞–º–º–∞ –æ–±—É—á–µ–Ω–∏—è</strong> –≤—ã–±–µ—Ä–∏—Ç–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –ø—Ä–æ–≥—Ä–∞–º–º—É, —á—Ç–æ–±—ã –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ —Ç–æ–ª—å–∫–æ –ø–æ –Ω–µ–π. –ï—Å–ª–∏ –≤—ã–±—Ä–∞—Ç—å <strong>–í—Å–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã</strong>, –æ—Ç—á–µ—Ç –±—É–¥–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –æ–±—â—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é.</li>
        <li>–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Ñ–ª–∞–∂–æ–∫ <strong>–ò—Å–∫–ª—é—á–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –±–µ–∑ –æ–±—É—á–µ–Ω–∏—è</strong>, —á—Ç–æ–±—ã –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å —Ç–æ–ª—å–∫–æ —Ç–µ—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–æ—à–ª–∏ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ –æ–±—É—á–µ–Ω–∏–µ (–∏–ª–∏ –≤—ã–±—Ä–∞–Ω–Ω—É—é –ø—Ä–æ–≥—Ä–∞–º–º—É).</li>
        <li>–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É <strong>–ü—Ä–∏–º–µ–Ω–∏—Ç—å</strong>, —á—Ç–æ–±—ã —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É —Å –¥–∞–Ω–Ω—ã–º–∏.</li>
        <li>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫—É <strong>–≠–∫—Å–ø–æ—Ä—Ç –≤ Excel</strong> –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –æ—Ç—á–µ—Ç–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ Excel.</li>
        <li>–õ–µ–≥–µ–Ω–¥–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç—É—Å—ã –æ–±—É—á–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤ —Ç–∞–±–ª–∏—Ü–µ:</li>
    </ol>
    <h3>–û–ø–∏—Å–∞–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤</h3>
    <ol>
        <li><strong>–ü—Ä–æ–π–¥–µ–Ω–æ</strong> (–∑–µ–ª–µ–Ω—ã–π —Ñ–æ–Ω): –û–±—É—á–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω–æ –≤ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Å—Ä–æ–∫–∏.</li>
        <li><strong>–ù–µ –ø—Ä–æ–π–¥–µ–Ω–æ</strong> (—Å–≤–µ—Ç–ª–æ-–∫—Ä–∞—Å–Ω—ã–π —Ñ–æ–Ω): –û–±—É—á–µ–Ω–∏–µ –Ω–µ –±—ã–ª–æ –Ω–∞—á–∞—Ç–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–º.</li>
        <li><strong>–ü—Ä–æ—Å—Ä–æ—á–µ–Ω–æ</strong> (–∫—Ä–∞—Å–Ω—ã–π —Ñ–æ–Ω): –°—Ä–æ–∫ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è –æ–±—É—á–µ–Ω–∏—è –∏—Å—Ç–µ–∫, –∏ –æ–Ω–æ –Ω–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ.</li>
        <li><strong>–°–∫–æ—Ä–æ –∏—Å—Ç–µ–∫–∞–µ—Ç</strong> (–∂–µ–ª—Ç—ã–π —Ñ–æ–Ω): –û–±—É—á–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ, –Ω–æ –¥–æ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è –æ—Å—Ç–∞–ª–æ—Å—å –º–µ–Ω–µ–µ 1 –º–µ—Å—è—Ü–∞.</li>
    </ol>
</div>
{% endif %}
<script>
    document.getElementById('employees').addEventListener('change', function() {
        const options = this.options;
        const allEmployeesOption = options[0];
        if (allEmployeesOption.selected) {
            for (let i = 1; i < options.length; i++) {
                options[i].selected = false;
            }
        } else if (this.selectedOptions.length > 0) {
            allEmployeesOption.selected = false;
        }
    });
</script>
{% endblock %}